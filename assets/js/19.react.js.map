{"version":3,"sources":["webpack:///./src/js/react-app/components/admin/articles/article_add.js"],"names":["AddArticle","props","state","recentValue","fetchCategories","fetchTags","nextProps","location","reset","clearMessages","prevProps","articleAdded","addArticleError","clearArticle","formProps","formpropsClone","formatOutFormFields","addArticle","createImgFormData","errorMessage","name","handleSubmit","handleFormSubmit","bind","onInputChange","treeTables","categories","tags","renderAdded","renderError","Component","validate","errors","slug","category","mapStateToProps","article","all","RequireAuth","reduxForm","form","fields","connect"],"mappings":"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","file":"19.react.js","sourcesContent":["import React, { Component } from 'react';\nimport { reduxForm, reset } from 'redux-form';\nimport { connect } from 'react-redux';\nimport { addArticle, addArticleError, clearArticle } from '../../../actions/articles';\nimport { fetchCategories } from '../../../actions/categories';\nimport { fetchTags } from '../../../actions/tags';\nimport Sidebar from '../sidebar';\nimport ArticleFields from './article_fields';\nimport ImgFieldCrop from '../parts/image_field_crop';\nimport { flattenObjArray } from '../../../lib/utils';\nimport { createImgFormData, formatOutFormFields } from '../../../lib/form_utils';\nimport RequireAuth from '../auth/require_auth';\nimport clone from 'lodash/clone';\n\nclass AddArticle extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      // store the most recent value \n      // since category turns to undefined after first form submit\n      recentValue: ''\n    }\n  }\n\n  componentWillMount() {\n    this.props.fetchCategories();\n    this.props.fetchTags();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    // if newly navigated from the router link...\n    if(nextProps.location !== this.props.location) {\n      //clear the form fields\n      this.props.reset('article-add');\n      //clear messages\n      this.clearMessages();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    //clear out error messsages if any\n    if (this.props.articleAdded && (prevProps.articleAdded !== this.props.articleAdded)) {\n      this.props.addArticleError('');\n    }\n  }\n\n  componentWillUnmount() {\n    //clear messages when navigating away\n    this.clearMessages();\n  }\n\n  clearMessages() {\n    this.props.clearArticle();\n    this.props.addArticleError('');\n  }\n\n  // if form isn't valit redux form will not call this function\n  handleFormSubmit(formProps) {\n    let formpropsClone = [];\n    formpropsClone = formatOutFormFields(formProps, [\n              'categories',\n              'tags'\n            ]);\n\n    // call action to submit edited\n    this.props.addArticle(createImgFormData('images', formpropsClone));\n  }\n\n\n  renderAdded() {\n    //only render if there's no error message\n    if(this.props.articleAdded && !this.props.errorMessage) {\n      return (\n        <div className=\"submission-message\">\n          <span>Article: {this.props.articleAdded.name}<br/>successfully added. </span>\n        </div>\n        )\n    }\n  }\n\n  renderError() {\n    if (this.props.errorMessage) {\n      return (\n        <div className=\"alert alert-danger\">\n          <strong>Oops!</strong> {this.props.errorMessage}\n        </div>\n        );\n    }\n  }\n\n  onInputChange() {\n      this.clearMessages();\n  }\n    \n  render() {\n      const { handleSubmit } = this.props;\n      return (\n        <div className=\"admin-main\">\n          <div className=\"row\">\n            <Sidebar/>\n            <div className=\"main-window columns small-12 large-9\">\n              <h3>Add Article</h3>\n              <form  onSubmit={handleSubmit(this.handleFormSubmit.bind(this))}>\n                <ArticleFields\n                    onInputChange={this.onInputChange.bind(this)}\n                    treeTables={this.props.treeTables}\n                    categories={this.props.categories}\n                    tags={this.props.tags}\n                />\n                <ImgFieldCrop\n                  name=\"images\"\n                  classNameLabel=\"file-input-label\"\n                  onChange={this.onInputChange.bind(this)}\n                  tags={this.props.tags}\n                />\n                <button action=\"submit\" className=\"btn btn-primary\">Submit</button>\n              </form>\n              {this.renderAdded()}\n              {this.renderError()}\n            </div>\n          </div>\n        </div>\n      );\n  }\n\n}\n\n\nfunction validate(formProps) {\n  const errors = {};\n\n  //todo: use the map or foreach to shorten this code\n  if (!formProps.name) {\n    errors.name = 'Please enter a name';\n  }\n\n  if (!formProps.slug) {\n    errors.slug = 'Please enter a slug';\n  }\n\n  if (!formProps.category) {\n    errors.category = 'Please enter a category';\n  }\n\n  if (!formProps.categories) {\n    errors.categories = 'Please enter at least one category';\n  }\n  \n  return errors;\n}\n\nfunction mapStateToProps(state) {\n  return { \n    articleAdded: state.article.articleAdded,\n    errorMessage: state.article.addArticleError,\n    categories: state.categories.all,\n    tags: state.tags.all,\n  };\n}\n\n\nexport default RequireAuth(reduxForm({\n  validate,\n  form: 'article-add',\n  fields: ['name', 'slug', 'files'],\n})(\nconnect(mapStateToProps, { addArticle, clearArticle, addArticleError, fetchCategories, fetchTags, reset })(AddArticle)\n));\n\n\n\n"],"sourceRoot":""}