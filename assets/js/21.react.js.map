{"version":3,"sources":["webpack:///./src/js/react-app/components/admin/trees/tree_add.js"],"names":["AddTree","props","state","recentValue","fetchTreeTables","nextProps","location","reset","clearMessages","prevProps","treeAdded","addTreeError","clearTree","formProps","formpropsClone","formatOutFormFields","addTree","createImgFormData","errorMessage","common_name","customError","handleSubmit","handleFormSubmit","bind","onInputChange","treeTables","tags","renderAdded","renderError","Component","validate","errors","name","slug","mapStateToProps","tree","all","RequireAuth","reduxForm","form","fields","connect"],"mappings":"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","file":"21.react.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { reduxForm, reset } from 'redux-form';\r\nimport { connect } from 'react-redux';\r\nimport { addTree, addTreeError, clearTree } from '../../../actions/trees';\r\nimport { fetchTreeTables } from '../../../actions/treeTables';\r\nimport Sidebar from '../sidebar';\r\nimport ImgFieldCrop from '../parts/image_field_crop';\r\nimport { createImgFormData, formatOutFormFields } from '../../../lib/form_utils';\r\nimport RequireAuth from '../auth/require_auth';\r\nimport TreeFields from './tree_fields';\r\n\r\nclass AddTree extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      // store the most recent value \r\n      // since theme turns to undefined after first form submit\r\n      recentValue: ''\r\n    }\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.props.fetchTreeTables();\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    // if newly navigated from the router link...\r\n    if(nextProps.location !== this.props.location) {\r\n      //clear the form fields\r\n      this.props.reset('tree-add');\r\n      //clear messages\r\n      this.clearMessages();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    //clear out error messsages if any\r\n    if (this.props.treeAdded && (prevProps.treeAdded !== this.props.treeAdded)) {\r\n      this.props.addTreeError('');\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    //clear messages when navigating away\r\n    this.clearMessages();\r\n  }\r\n\r\n  clearMessages() {\r\n    this.props.clearTree();\r\n    this.props.addTreeError('');\r\n  }\r\n\r\n  // if form isn't valit redux form will not call this function\r\n  handleFormSubmit(formProps) {\r\n    let formpropsClone = [];\r\n    formpropsClone = formatOutFormFields(formProps, [\r\n                'origins', \r\n                'eco_benefits', \r\n                'native_to',\r\n                'shapes', \r\n                'light', \r\n                'soil', \r\n                'natural_habitat', \r\n                'common_uses', \r\n                'transplanting', \r\n                'unique_attractions', \r\n                'tolerances',\r\n                'insects',\r\n                'diseases',\r\n            ]);\r\n\r\n    // call action to submit edited\r\n    this.props.addTree(createImgFormData('images', formpropsClone));\r\n  }\r\n\r\n  renderAdded() {\r\n    //only render if there's no error message\r\n    if(this.props.treeAdded && !this.props.errorMessage) {\r\n      return (\r\n        <div className=\"submission-message\">\r\n          <span>Tree: {this.props.treeAdded.common_name}<br/>successfully added. </span>\r\n        </div>\r\n        )\r\n    }\r\n  }\r\n\r\n  renderError() {\r\n    if (this.props.errorMessage) {\r\n      return (\r\n        <div className=\"alert alert-danger\">\r\n          <strong>Oops!</strong> {this.props.errorMessage}\r\n        </div>\r\n        );\r\n    }\r\n    if (this.customError) {\r\n      return (\r\n        <div className=\"alert alert-danger\">\r\n          <strong>Oops!</strong> {this.customError}\r\n        </div>\r\n        );\r\n    }\r\n  }\r\n\r\n  onInputChange() {\r\n      this.clearMessages();\r\n  }\r\n    \r\n  render() {\r\n      const { handleSubmit } = this.props;\r\n      return (\r\n        <div className=\"admin-main\">\r\n          <div className=\"row\">\r\n            <Sidebar/>\r\n            <div className=\"main-window columns small-12 large-9\">\r\n              <h3>Add Plant</h3>\r\n              <form  onSubmit={handleSubmit(this.handleFormSubmit.bind(this))}>\r\n                <TreeFields\r\n                    onInputChange={this.onInputChange.bind(this)}\r\n                    treeTables={this.props.treeTables}\r\n                />\r\n\r\n                <ImgFieldCrop\r\n                  name=\"images\"\r\n                  classNameLabel=\"file-input-label\"\r\n                  onChange={this.onInputChange.bind(this)}\r\n                  tags={this.props.treeTables.tags}\r\n                />\r\n                <button action=\"submit\" className=\"btn btn-primary\">Submit</button>\r\n              </form>\r\n              {this.renderAdded()}\r\n              {this.renderError()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction validate(formProps) {\r\n  let errors = {};\r\n\r\n  //todo: use the map or foreach to shorten this code\r\n  if (!formProps.name) {\r\n    errors.name = 'Please enter a name';\r\n  }\r\n\r\n  if (!formProps.slug) {\r\n    errors.slug = 'Please enter a slug';\r\n  }\r\n\r\n  // if (!formProps.genus_id) {\r\n  //   errors.genus_id = 'Please enter a genus';\r\n  // }\r\n\r\n  // if (!formProps.specific_epithet) {\r\n  //   errors.specific_epithet = 'Please enter a specific epithet';\r\n  // }\r\n\r\n  // if (!formProps.trees_category_id) {\r\n  //   errors.trees_category_id = 'Please enter a tree category';\r\n  // }\r\n\r\n  // if (!formProps.origins) {\r\n  //    errors.origins = 'Please enter at least one origin';\r\n  // }\r\n  \r\n  return errors;\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return { \r\n    treeAdded: state.tree.treeAdded,\r\n    errorMessage: state.tree.addTreeError,\r\n    treeTables: state.treeTables.all,\r\n  };\r\n}\r\n\r\n\r\nexport default RequireAuth(reduxForm({\r\n  validate,\r\n  form: 'tree-add',\r\n  fields: ['name', 'slug', 'files'],\r\n})(\r\nconnect(mapStateToProps, { addTree, clearTree, addTreeError, fetchTreeTables, reset })(AddTree)\r\n));\r\n\r\n\r\n\r\n"],"sourceRoot":""}