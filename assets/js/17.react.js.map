{"version":3,"sources":["webpack:///./src/js/react-app/components/admin/parts/uploaded_images.js","webpack:///./src/js/react-app/components/admin/trees/tree_edit.js"],"names":["env","process","UPLOADS_PATH","require","UploadedImages","props","state","images","deletedImages","refType","index","onChange","updatedImages","clone","splice","imageDeleted","push","setState","updateImages","item","imgStr","description","name","copyStringToClipboard","ref_type","map","onDeleteClick","bind","onCopyClick","imgName","tag_name","renderImages","Component","EditTree","imagesToDelete","selectedItem","fetchTreeTables","getTree","match","params","treeId","prevProps","treeData","handleInitialize","clearMessages","clearUpdateTree","refs","initImages","formData","id","common_name","other_common_names","slug","specific_epithet","other_species","subspecies","variety","cultivar","body","genus_id","trees_category_id","zone_id","reproduction_type_id","height_min","height_max","width_min","width_max","growth_rate","lifespan_min","lifespan_max","formatToMultiselect","origins","eco_benefits","native_to","shapes","light","soil","natural_habitat","common_uses","transplanting","unique_attractions","tolerances","insects","diseases","initialize","formProps","formpropsClone","formatOutFormFields","updateTree","createImgFormData","change","inArray","treeUpdated","delImages","Object","keys","forEach","key","toString","JSON","stringify","handleSubmit","handleFormSubmit","onInputChange","treeTables","renderHiddenField","tags","renderUpdated","validate","errors","mapStateToProps","ownProps","selector","formValueSelector","tree","treeSingle","all","RequireAuth","reduxForm","form","fields","connect"],"mappings":"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","file":"17.react.js","sourcesContent":["import React, { Component } from 'react';\r\nimport clone from 'lodash/clone';\r\nimport { imgName, copyStringToClipboard } from '../../../lib/stringUtils'\r\n//config\r\nconst env = process.env.NODE_ENV || \"development\";\r\nvar { UPLOADS_PATH } = require('../../../config')[env];\r\n\r\nclass UploadedImages extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\timages: [],\r\n\t\t\tdeletedImages: []\r\n\t\t}\r\n\t\tthis.refType = '';\r\n\t}\r\n\r\n\tonDeleteClick(index) {\r\n\t\t//callback updated\r\n\t\tthis.props.onChange();\r\n\t\t//remove image at index\r\n\t\tlet updatedImages = clone(this.state.images);\r\n\t\tupdatedImages.splice(index, 1);\r\n\r\n\t\tlet deletedImages = clone(this.state.deletedImages);\r\n\t\tlet imageDeleted = clone(this.state.images[index]);\r\n\t\tdeletedImages.push(imageDeleted);\r\n\r\n\t\t//update local state\r\n\t\tthis.setState({ images: updatedImages });\r\n\t\tthis.setState({ deletedImages });\r\n\r\n\t\t//update parent\r\n\t\tthis.props.updateImages(updatedImages, deletedImages);\r\n\t}\r\n\r\n\tonCopyClick(item) {\r\n\t\tlet imgStr = '<img alt=\"' + item.description + '\" src=\"/uploads/' + this.refType + '/' + item.name + '\" />';\r\n\t\tcopyStringToClipboard(imgStr);\r\n\t}\r\n\r\n\tinitImages(images, ref_type) {\r\n\t\tthis.refType = ref_type;\r\n\t\tthis.setState({ images: images }, () => {\r\n\t\t\t//sent initial state back to parent to avoid it \r\n\t\t\t//being empty if one doesn't delete\r\n\t\t\tthis.props.updateImages(images, []);\r\n\t\t});\r\n\t}\r\n\r\n\trenderImages() {\r\n\t\treturn (\r\n\t\t\t<div className=\"drop-preview-wrapper\">\r\n\t\t\t\t{this.state.images.map((item, index) => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div key={index} className=\"drop-preview\">\r\n\t\t\t\t\t\t\t<a href=\"#\" className=\"close-btn\" onClick={this.onDeleteClick.bind(this, index)}></a>\r\n\t\t\t\t\t\t\t<button className=\"copy-btn\" onClick={this.onCopyClick.bind(this, item)}>copy</button>\r\n\t\t\t\t\t\t\t<img className=\"drop-img-preview\" src={'/uploads/' + this.refType + '/' + imgName(item.name, 'small')} />\r\n\t\t\t\t\t\t\t<div className=\"desc\">\r\n\t\t\t\t\t\t\t  {item.name}\r\n\t\t\t\t\t\t\t  <br/>\r\n\t\t\t\t\t\t\t  {item.tag_name && 'tag: ' + item.tag_name}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t)\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t{this.renderImages()}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default UploadedImages;\r\n\r\n\r\n","import React, { Component } from 'react';\r\nimport { reduxForm, Field, change, formValueSelector } from 'redux-form';\r\nimport { getTree, clearUpdateTree, updateTree } from '../../../actions/trees';\r\nimport { fetchTreeTables } from '../../../actions/treeTables';\r\nimport Sidebar from '../sidebar';\r\nimport { connect } from 'react-redux';\r\nimport renderHiddenField from '../parts/field_hidden';\r\nimport UploadedImages from '../parts/uploaded_images';\r\nimport ImgFieldCrop from '../parts/image_field_crop';\r\nimport { createImgFormData, formatOutFormFields } from '../../../lib/form_utils';\r\nimport RequireAuth from '../auth/require_auth';\r\nimport clone from 'lodash/clone';\r\nimport TreeFields from './tree_fields';\r\n\r\n\r\n\r\nclass EditTree extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            images: [],\r\n            imagesToDelete: [],\r\n            selectedItem: ''\r\n        }\r\n    }\r\n\r\n    componentWillMount() {\r\n        this.props.fetchTreeTables();\r\n        //get initial data to populate the form\r\n        this.props.getTree(this.props.match.params.treeId);\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        if (this.props.treeData && (prevProps.treeData !== this.props.treeData)) {\r\n            this.handleInitialize();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      //clear messages when navigating away\r\n      this.clearMessages();\r\n    }\r\n\r\n    clearMessages() {\r\n      this.props.clearUpdateTree();\r\n    }\r\n\r\n    handleInitialize() {\r\n        let images = clone(this.props.treeData.images);\r\n\r\n        //store initial images for comparison later\r\n        this.setState({ images });\r\n        //init images on UploadedImages component\r\n        this.refs.UploadedImages.initImages(images, 'trees');\r\n\r\n        // set tree values for the fields\r\n        const formData = {\r\n            //still must keep this for the id eventhough it isn't rendered\r\n            'tree_id': this.props.treeData.id,\r\n            'common_name': this.props.treeData.common_name,\r\n            'other_common_names': this.props.treeData.other_common_names,\r\n            'slug': this.props.treeData.slug,\r\n            'specific_epithet': this.props.treeData.specific_epithet,\r\n            'other_species': this.props.treeData.other_species,\r\n            'subspecies': this.props.treeData.subspecies,\r\n            'variety': this.props.treeData.variety,\r\n            'cultivar': this.props.treeData.cultivar,\r\n            'body': this.props.treeData.body,\r\n            'genus_id': this.props.treeData.genus_id,\r\n            'trees_category_id': this.props.treeData.trees_category_id,\r\n            'zone_id': this.props.treeData.zone_id,\r\n            'reproduction_type_id': this.props.treeData.reproduction_type_id,\r\n            'height_min': this.props.treeData.height_min,\r\n            'height_max': this.props.treeData.height_max,\r\n            'width_min': this.props.treeData.width_min,\r\n            'width_max': this.props.treeData.width_max,\r\n            'growth_rate': this.props.treeData.growth_rate,\r\n            'lifespan_min': this.props.treeData.lifespan_min,\r\n            'lifespan_max': this.props.treeData.lifespan_max,\r\n            //multiselects\r\n            'origins': this.formatToMultiselect(this.props.treeData.origins),\r\n            'eco_benefits': this.formatToMultiselect(this.props.treeData.eco_benefits),\r\n            'native_to': this.formatToMultiselect(this.props.treeData.native_to),\r\n            'shapes': this.formatToMultiselect(this.props.treeData.shapes),\r\n            'light': this.formatToMultiselect(this.props.treeData.light),\r\n            'soil': this.formatToMultiselect(this.props.treeData.soil),\r\n            'natural_habitat': this.formatToMultiselect(this.props.treeData.natural_habitat),\r\n            'common_uses': this.formatToMultiselect(this.props.treeData.common_uses),\r\n            'transplanting': this.formatToMultiselect(this.props.treeData.transplanting),\r\n            'unique_attractions': this.formatToMultiselect(this.props.treeData.unique_attractions),\r\n            'tolerances': this.formatToMultiselect(this.props.treeData.tolerances),\r\n            'insects': this.formatToMultiselect(this.props.treeData.insects),\r\n            'diseases': this.formatToMultiselect(this.props.treeData.diseases),\r\n        };\r\n\r\n        this.props.initialize(formData);\r\n    }\r\n\r\n    // if form isn't valid redux form will not call this function\r\n    handleFormSubmit(formProps) {\r\n        let formpropsClone = [];\r\n\r\n        formpropsClone = formatOutFormFields(formProps, [\r\n                'origins', \r\n                'eco_benefits',\r\n                'native_to',\r\n                'shapes', \r\n                'light', \r\n                'soil', \r\n                'natural_habitat', \r\n                'common_uses', \r\n                'transplanting', \r\n                'unique_attractions', \r\n                'tolerances',\r\n                'insects',\r\n                'diseases',\r\n            ]);\r\n\r\n        // call action to submit edited\r\n        this.props.updateTree(createImgFormData('new_images', formpropsClone));\r\n        //clear deleted images\r\n        this.props.change('deleted_images', '');\r\n    }\r\n\r\n    formatToMultiselect(inArray) {\r\n        return inArray.map((item) => {\r\n            //return { value: item.id, label: item.name }\r\n            return item.id;\r\n        });\r\n    }\r\n\r\n    renderUpdated() {\r\n        if(this.props.treeUpdated) {\r\n            return (\r\n                <div className=\"submission-message\">\r\n                    <span>Tree: {this.props.treeUpdated.common_name}<br/>successfully updated.</span>\r\n                </div>\r\n            )\r\n        }\r\n    }\r\n\r\n    updatedImages(images, deletedImages) {\r\n        let delImages = [];\r\n        Object.keys(deletedImages).forEach((key) => {\r\n            delImages[key] = deletedImages[key].name;\r\n        })\r\n        this.props.change('deleted_images', delImages.toString());\r\n\r\n        // update updated_images field with the upated images in string form\r\n        this.props.change('images', JSON.stringify(images));\r\n    }\r\n\r\n    onInputChange() {\r\n        this.clearMessages();\r\n    }\r\n    \r\n    render() {\r\n        const { handleSubmit } = this.props;\r\n        return (\r\n            <div className=\"admin-main\">\r\n                <div className=\"row\">\r\n                    <Sidebar/>\r\n                    <div className=\"main-window columns small-12 large-9\">\r\n                        <h3>Edit Plant</h3>\r\n\r\n                        <form onSubmit={handleSubmit(this.handleFormSubmit.bind(this))}>\r\n                            <TreeFields\r\n                                treeId={this.props.treeData.id}\r\n                                onInputChange={this.onInputChange.bind(this)}\r\n                                treeTables={this.props.treeTables}\r\n                            />\r\n\r\n                            <UploadedImages\r\n                                ref=\"UploadedImages\"\r\n                                updateImages={this.updatedImages.bind(this)}\r\n                                onChange={this.onInputChange.bind(this)}\r\n                            />\r\n                            <Field\r\n                                name=\"deleted_images\"\r\n                                component={renderHiddenField}\r\n                            />\r\n                            <Field\r\n                                name=\"images\"\r\n                                component={renderHiddenField}\r\n                            />\r\n                            <ImgFieldCrop\r\n                                name=\"new_images\"\r\n                                label=\"New Images\"\r\n                                classNameLabel=\"file-input-label\"\r\n                                onChange={this.onInputChange.bind(this)}\r\n                                tags={this.props.treeTables.tags}\r\n                            />\r\n                            <button action=\"submit\" className=\"btn btn-primary\">Submit</button>\r\n                        </form>\r\n                        {this.renderUpdated()}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction validate(formProps) {\r\n    const errors = {};\r\n\r\n    //todo: use the map or foreach to shorten this code\r\n    if (!formProps.common_name) {\r\n        errors.common_name = 'Please enter a common name';\r\n    }\r\n\r\n    if (!formProps.slug) {\r\n        errors.slug = 'Please enter a slug';\r\n    }\r\n\r\n    // if (!formProps.trees_category_id) {\r\n    //   errors.trees_category_id = 'Please enter a category';\r\n    // }\r\n\r\n    // if (formProps.origins) {\r\n    //     if (formProps.origins.length === 0) {\r\n    //         errors.origins = 'Please enter at least one origin';\r\n    //     }\r\n    // }\r\n    \r\n    return errors;\r\n}\r\n\r\nfunction mapStateToProps(state, ownProps) {\r\n    const selector = formValueSelector('tree-add');\r\n    return {\r\n        treeUpdated: state.tree.treeUpdated,\r\n        treeData: state.tree.treeSingle,\r\n        treeTables: state.treeTables.all,\r\n    };\r\n}\r\n\r\nexport default RequireAuth(reduxForm({\r\n    validate,\r\n    form: 'tree-add',\r\n    fields: ['common_name', 'slug', 'body'],\r\n})(\r\n    connect(mapStateToProps, { getTree, clearUpdateTree, updateTree, fetchTreeTables })(EditTree)\r\n    ));\r\n\r\n\r\n\r\n"],"sourceRoot":""}